openapi: 3.0.0
info:
  title: CodeFRAME Project Creation API
  description: API contract for creating new projects in CodeFRAME
  version: 1.0.0
  contact:
    name: CodeFRAME Team
servers:
  - url: http://localhost:8080
    description: Local development server

paths:
  /api/projects:
    post:
      summary: Create a new project
      description: |
        Creates a new CodeFRAME project with the specified name, description, and type.

        **Validation Rules**:
        - Project name must be unique across all projects
        - Name must contain only lowercase letters, numbers, hyphens, and underscores
        - Description must be at least 10 characters (frontend enforces this, backend min is 1)

        **Workspace Creation**:
        - Automatically creates a workspace directory for the project
        - Initializes git repository if source_type is 'new_repo'
        - Workspace path is returned in the response

      operationId: createProject
      tags:
        - Projects

      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - description
              properties:
                name:
                  type: string
                  minLength: 3
                  maxLength: 100
                  pattern: '^[a-z0-9-_]+$'
                  description: |
                    Unique project identifier (lowercase letters, numbers, hyphens, underscores only)
                  example: "my-awesome-app"

                description:
                  type: string
                  minLength: 10
                  maxLength: 500
                  description: Project description or purpose (minimum 10 characters)
                  example: "A web application for managing team tasks and projects"

                projectType:
                  type: string
                  enum:
                    - python
                    - typescript
                    - fullstack
                    - other
                  default: python
                  description: Primary technology stack for the project
                  example: "fullstack"

            examples:
              pythonProject:
                summary: Python Backend Project
                value:
                  name: "task-api"
                  description: "RESTful API for task management using FastAPI and PostgreSQL"
                  projectType: "python"

              fullstackProject:
                summary: Full-Stack Application
                value:
                  name: "social-dashboard"
                  description: "Social media analytics dashboard with React frontend and Python backend"
                  projectType: "fullstack"

      responses:
        '201':
          description: Project created successfully
          content:
            application/json:
              schema:
                type: object
                required:
                  - id
                  - name
                  - status
                properties:
                  id:
                    type: integer
                    description: Auto-generated unique project ID
                    example: 42

                  name:
                    type: string
                    description: Project name (echoed from request)
                    example: "my-awesome-app"

                  status:
                    type: string
                    enum: [init, active, paused, completed]
                    description: Current project status
                    example: "init"

                  phase:
                    type: string
                    enum: [discovery, prd_generation, implementation, testing, deployment]
                    description: Current project phase
                    example: "discovery"

                  created_at:
                    type: string
                    format: date-time
                    description: ISO 8601 timestamp of project creation
                    example: "2025-11-18T18:30:00Z"

                  config:
                    type: object
                    nullable: true
                    description: Project configuration settings (null for new projects)
                    example: null

              examples:
                success:
                  summary: Successful creation
                  value:
                    id: 42
                    name: "my-awesome-app"
                    status: "init"
                    phase: "discovery"
                    created_at: "2025-11-18T18:30:00Z"
                    config: null

        '400':
          description: Bad Request - Invalid input format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidNameFormat:
                  summary: Invalid project name format
                  value:
                    detail: "Invalid project name format"

                descriptionTooShort:
                  summary: Description too short
                  value:
                    detail: "description must be at least 10 characters"

                invalidPattern:
                  summary: Name contains invalid characters
                  value:
                    detail: "Project name must contain only lowercase letters, numbers, hyphens, and underscores"

        '409':
          description: Conflict - Project name already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                duplicateName:
                  summary: Duplicate project name
                  value:
                    detail: "Project with name 'my-awesome-app' already exists"

        '422':
          description: Unprocessable Entity - Pydantic validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  detail:
                    type: array
                    items:
                      type: object
                      properties:
                        loc:
                          type: array
                          items:
                            oneOf:
                              - type: string
                              - type: integer
                          description: Location of the error (field path)
                        msg:
                          type: string
                          description: Error message
                        type:
                          type: string
                          description: Error type identifier
              examples:
                missingField:
                  summary: Missing required field
                  value:
                    detail:
                      - loc: ["body", "name"]
                        msg: "field required"
                        type: "value_error.missing"

        '500':
          description: Internal Server Error - Workspace creation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                workspaceCreationFailed:
                  summary: Workspace creation failure
                  value:
                    detail: "Workspace creation failed: Permission denied creating directory /workspace/my-app"

components:
  schemas:
    ErrorResponse:
      type: object
      required:
        - detail
      properties:
        detail:
          type: string
          description: Human-readable error message
          example: "Project with name 'my-app' already exists"

  securitySchemes:
    # Currently no authentication (local-only development mode)
    # Future: Add API key or OAuth for hosted mode

security:
  [] # No security for local development

tags:
  - name: Projects
    description: Project creation and management endpoints
